var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function s(t){let e;return l(t,(t=>e=t))(),e}function u(t,e,n){t.$$.on_destroy.push(l(e,n))}function i(t,e){t.appendChild(e)}function a(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode.removeChild(t)}function f(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function h(){return m(" ")}function $(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function b(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function v(t,e,n){t.classList[n?"add":"remove"](e)}let y;function x(t){y=t}function w(){if(!y)throw new Error("Function called outside component initialization");return y}function k(){const t=w();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const r=function(t,e,n=!1){const o=document.createEvent("CustomEvent");return o.initCustomEvent(t,n,!1,e),o}(e,n);o.slice().forEach((e=>{e.call(t,r)}))}}}const C=[],_=[],E=[],A=[],j=Promise.resolve();let q=!1;function L(t){E.push(t)}const O=new Set;let P=0;function S(){const t=y;do{for(;P<C.length;){const t=C[P];P++,x(t),M(t.$$)}for(x(null),C.length=0,P=0;_.length;)_.pop()();for(let t=0;t<E.length;t+=1){const e=E[t];O.has(e)||(O.add(e),e())}E.length=0}while(C.length);for(;A.length;)A.pop()();q=!1,O.clear(),x(t)}function M(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(L)}}const z=new Set;let N;function T(){N={r:0,c:[],p:N}}function B(){N.r||o(N.c),N=N.p}function I(t,e){t&&t.i&&(z.delete(t),t.i(e))}function J(t,e,n,o){if(t&&t.o){if(z.has(t))return;z.add(t),N.c.push((()=>{z.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function U(t){t&&t.c()}function F(t,n,c,l){const{fragment:s,on_mount:u,on_destroy:i,after_update:a}=t.$$;s&&s.m(n,c),l||L((()=>{const n=u.map(e).filter(r);i?i.push(...n):o(n),t.$$.on_mount=[]})),a.forEach(L)}function K(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function R(t,e){-1===t.$$.dirty[0]&&(C.push(t),q||(q=!0,j.then(S)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Z(e,r,c,l,s,u,i,a=[-1]){const f=y;x(e);const p=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(f?f.$$.context:[])),callbacks:n(),dirty:a,skip_bound:!1,root:r.target||f.$$.root};i&&i(p.root);let m=!1;if(p.ctx=c?c(e,r.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return p.ctx&&s(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),m&&R(e,t)),n})):[],p.update(),m=!0,o(p.before_update),p.fragment=!!l&&l(p.ctx),r.target){if(r.hydrate){const t=function(t){return Array.from(t.childNodes)}(r.target);p.fragment&&p.fragment.l(t),t.forEach(d)}else p.fragment&&p.fragment.c();r.intro&&I(e.$$.fragment),F(e,r.target,r.anchor,r.customElement),S()}x(f)}class D{$destroy(){K(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const G="ABCDEFGHIJKLMNOPQRSTUVWXYZ",H=()=>{const t=[...Array(26).keys()].map((t=>[Math.random(),t])).sort(((t,e)=>t[0]-e[0])).map((t=>t[1]));return t.some(((t,e)=>t==e))?H():t.map((t=>G[t]))},Q=t=>t.replace(/[^\x00-\x7F]+/g,""),V=[];function W(e,n=t){let o;const r=new Set;function l(t){if(c(e,t)&&(e=t,o)){const t=!V.length;for(const t of r)t[1](),V.push(t,e);if(t){for(let t=0;t<V.length;t+=2)V[t][0](V[t+1]);V.length=0}}}return{set:l,update:function(t){l(t(e))},subscribe:function(c,s=t){const u=[c,s];return r.add(u),1===r.size&&(o=n(l)||t),c(e),()=>{r.delete(u),0===r.size&&(o(),o=null)}}}}const X=W([{id:"",name:"",progress:null,solved:!1,conn:{}}].slice(1)),Y=W(""),tt=W(null),et=W(`person-${parseInt(1e4*Math.random())}`),nt=W(null),ot=W(null),rt=W(!1),ct=new Map,lt=function(e,n,c){const s=!Array.isArray(e),u=s?[e]:e,i=n.length<2;return a=e=>{let c=!1;const a=[];let d=0,f=t;const p=()=>{if(d)return;f();const o=n(s?a[0]:a,e);i?e(o):f=r(o)?o:t},m=u.map(((t,e)=>l(t,(t=>{a[e]=t,d&=~(1<<e),c&&p()}),(()=>{d|=1<<e}))));return c=!0,p(),function(){o(m),f()}},{subscribe:W(c,a).subscribe};var a}([Y,et,ot,rt],(([t,e,n,o])=>({id:t,name:e,progress:n,solved:o}))),st=0,ut=1,it=2,at=3,dt=new URLSearchParams(location.search).get("game"),ft=null==dt,pt=new window.Peer,mt=[(t,e)=>{X.update((n=>[...n,{id:t,name:e.name,progress:null,solved:!1}]))},(t,e)=>{tt.set(e.problem)},(t,e)=>{ft&&X.update((n=>n.map((n=>n.id!==t?n:{...n,progress:e.progress,solved:e.solved}))))},(t,e)=>{if(ft)return;const n=s(Y);X.set(e.users.filter((t=>t.id!==n)))}],ht=t=>new Promise((e=>{t.on("open",(()=>{var n;t.peer==dt&&nt.set(t),ct.set(t.peer,t),t.on("data",(n=t.peer,t=>{mt[t.type]&&mt[t.type](n,t)})),t.on("close",(t=>()=>{X.update((e=>e.filter((e=>e.id!==t)))),ct.delete(t)})(t.peer)),setTimeout((()=>{(t=>{t?.send({type:st,name:s(et)})})(t)}),100),e(t)}))})),$t=t=>ct.forEach((e=>e.send(t)));pt.on("open",Y.set),pt.on("connection",ht);const gt=[lt.subscribe((t=>{ft?$t({type:at,users:[...s(X).map((t=>({...t,conn:null}))),t]}):s(nt)?.send({type:it,progress:t.progress,solved:t.solved})})),tt.subscribe((t=>{ft&&$t({type:ut,problem:t})}))];function bt(e){let n,o,r,c,l,s,u,f,v=e[0]?"Join Link (copied)":"Copy Join Link";return{c(){n=p("div"),o=p("button"),r=m(v),c=h(),l=p("a"),s=m(e[1]),g(o,"class","join-link svelte-vczin0"),g(l,"href",e[1]),g(n,"class","join-links svelte-vczin0")},m(t,d){a(t,n,d),i(n,o),i(o,r),i(n,c),i(n,l),i(l,s),u||(f=$(o,"click",e[2]),u=!0)},p(t,[e]){1&e&&v!==(v=t[0]?"Join Link (copied)":"Copy Join Link")&&b(r,v),2&e&&b(s,t[1]),2&e&&g(l,"href",t[1])},i:t,o:t,d(t){t&&d(n),u=!1,f()}}}function vt(t,e,n){let o,r;u(t,Y,(t=>n(3,r=t)));let c=!1;return t.$$.update=()=>{8&t.$$.dirty&&n(1,o=`${location.href}?game=${encodeURIComponent(r)}`)},[c,o,()=>{navigator.clipboard.writeText(o),n(0,c=!0)},r]}window.$cryptoduel$subscriptions&&window.$cryptoduel$subscriptions.forEach((t=>t())),window.$cryptoduel$subscriptions=gt;class yt extends D{constructor(t){super(),Z(this,t,vt,bt,c,{})}}function xt(t,e,n){const o=t.slice();o[6]=e[n],o[8]=n;const r=o[2][o[8]];return o[1]=r,o}function wt(t){let e,n,o,r,c,l,s,u,f,y,x=t[6]+"",w=t[1]+"";return{c(){e=p("div"),n=p("div"),o=m(x),r=h(),c=p("div"),l=p("pre"),s=m(w),u=h(),g(n,"class","cipher-letter svelte-1x2ot2m"),g(c,"class","decrypted-letter svelte-1x2ot2m"),g(c,"tabindex","0"),v(c,"non-alphabetic",null===t[1]),g(e,"class","plain-encrypt-pair svelte-1x2ot2m")},m(d,p){a(d,e,p),i(e,n),i(n,o),i(e,r),i(e,c),i(c,l),i(l,s),i(e,u),f||(y=$(c,"keydown",t[3](t[8])),f=!0)},p(e,n){t=e,1&n&&x!==(x=t[6]+"")&&b(o,x),4&n&&w!==(w=t[1]+"")&&b(s,w),4&n&&v(c,"non-alphabetic",null===t[1])},d(t){t&&d(e),f=!1,y()}}}function kt(e){let n,o=e[0],r=[];for(let t=0;t<o.length;t+=1)r[t]=wt(xt(e,o,t));return{c(){n=p("div");for(let t=0;t<r.length;t+=1)r[t].c();g(n,"class","word svelte-1x2ot2m")},m(t,e){a(t,n,e);for(let t=0;t<r.length;t+=1)r[t].m(n,null)},p(t,[e]){if(13&e){let c;for(o=t[0],c=0;c<o.length;c+=1){const l=xt(t,o,c);r[c]?r[c].p(l,e):(r[c]=wt(l),r[c].c(),r[c].m(n,null))}for(;c<r.length;c+=1)r[c].d(1);r.length=o.length}},i:t,o:t,d(t){t&&d(n),f(r,t)}}}function Ct(t,e,n){let o,{word:r=""}=e,{replacement:c=Array(26).fill("")}=e;const l=k();return t.$$set=t=>{"word"in t&&n(0,r=t.word),"replacement"in t&&n(1,c=t.replacement)},t.$$.update=()=>{3&t.$$.dirty&&n(2,o=((t,e)=>[...t].map((t=>{const n=G.indexOf(t);return-1===n?null:e[n]})))(r,c))},[r,c,o,t=>e=>{l("replace",{from:r[t],to:e.key.toUpperCase()})}]}class _t extends D{constructor(t){super(),Z(this,t,Ct,kt,c,{word:0,replacement:1})}}function Et(t,e,n){const o=t.slice();return o[9]=e[n],o}function At(t){let e,n;return e=new _t({props:{word:t[9],replacement:t[1]}}),e.$on("replace",t[5]),{c(){U(e.$$.fragment)},m(t,o){F(e,t,o),n=!0},p(t,n){const o={};8&n&&(o.word=t[9]),2&n&&(o.replacement=t[1]),e.$set(o)},i(t){n||(I(e.$$.fragment,t),n=!0)},o(t){J(e.$$.fragment,t),n=!1},d(t){K(e,t)}}}function jt(t){let e,n,o,r,c,l,s=t[0].author+"",u=t[3],$=[];for(let e=0;e<u.length;e+=1)$[e]=At(Et(t,u,e));const y=t=>J($[t],1,1,(()=>{$[t]=null}));return{c(){e=p("p"),n=m("Solve this quote by "),o=m(s),r=h(),c=p("div");for(let t=0;t<$.length;t+=1)$[t].c();g(e,"class","svelte-xqyi96"),g(c,"class","cryptogram svelte-xqyi96"),v(c,"solved",t[2])},m(t,s){a(t,e,s),i(e,n),i(e,o),a(t,r,s),a(t,c,s);for(let t=0;t<$.length;t+=1)$[t].m(c,null);l=!0},p(t,[e]){if((!l||1&e)&&s!==(s=t[0].author+"")&&b(o,s),26&e){let n;for(u=t[3],n=0;n<u.length;n+=1){const o=Et(t,u,n);$[n]?($[n].p(o,e),I($[n],1)):($[n]=At(o),$[n].c(),I($[n],1),$[n].m(c,null))}for(T(),n=u.length;n<$.length;n+=1)y(n);B()}4&e&&v(c,"solved",t[2])},i(t){if(!l){for(let t=0;t<u.length;t+=1)I($[t]);l=!0}},o(t){$=$.filter(Boolean);for(let t=0;t<$.length;t+=1)J($[t]);l=!1},d(t){t&&d(e),t&&d(r),t&&d(c),f($,t)}}}function qt(t,e,n){let o,r,{problem:c=null}=e;const l=k();let s=Array(26).fill("");const u=({from:t,to:e})=>{if((1!=e.length||!/[a-zA-Z]/.test(e))&&"BACKSPACE"!==e)return;const o=[...s];o[G.indexOf(t)]="BACKSPACE"==e?"":e,n(1,s=o)},i=(t,e)=>[...e].map((e=>G.includes(e)&&""!==t[G.indexOf(e)]));return t.$$set=t=>{"problem"in t&&n(0,c=t.problem)},t.$$.update=()=>{1&t.$$.dirty&&n(1,s=Array(26).fill("")),1&t.$$.dirty&&n(3,o=(t=>[...t.split(/\s+/g)])(c.ciphertext)),3&t.$$.dirty&&n(2,r=((t,e)=>!!e&&[...e.ciphertext].every(((n,o)=>!G.includes(n)||e.plaintext[o]===t[G.indexOf(n)])))(s,c)),4&t.$$.dirty&&r&&l("solved"),3&t.$$.dirty&&l("progress",{progress:i(s,c.ciphertext)}),t.$$.dirty},[c,s,r,o,u,t=>u(t.detail)]}class Lt extends D{constructor(t){super(),Z(this,t,qt,jt,c,{problem:0})}}function Ot(t,e,n){const o=t.slice();return o[1]=e[n],o}function Pt(t,e,n){const o=t.slice();return o[4]=e[n],o}function St(t){let e,n=t[1].progress,o=[];for(let e=0;e<n.length;e+=1)o[e]=zt(Pt(t,n,e));return{c(){e=p("div");for(let t=0;t<o.length;t+=1)o[t].c();g(e,"class","opponent-progress svelte-127q1j8")},m(t,n){a(t,e,n);for(let t=0;t<o.length;t+=1)o[t].m(e,null)},p(t,r){if(1&r){let c;for(n=t[1].progress,c=0;c<n.length;c+=1){const l=Pt(t,n,c);o[c]?o[c].p(l,r):(o[c]=zt(l),o[c].c(),o[c].m(e,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=n.length}},d(t){t&&d(e),f(o,t)}}}function Mt(e){let n;return{c(){n=p("p"),n.textContent="has not started yet..."},m(t,e){a(t,n,e)},p:t,d(t){t&&d(n)}}}function zt(t){let e;return{c(){e=p("div"),g(e,"class","progress-item svelte-127q1j8"),v(e,"has-done",t[4])},m(t,n){a(t,e,n)},p(t,n){1&n&&v(e,"has-done",t[4])},d(t){t&&d(e)}}}function Nt(t){let e,n,o,r,c,l,s=t[1].name+"";function u(t,e){return null==t[1].progress?Mt:St}let f=u(t),$=f(t);return{c(){e=p("div"),n=p("p"),o=m(s),r=m(":"),c=h(),$.c(),l=h(),g(e,"class","user-container svelte-127q1j8"),v(e,"solved",t[1].solved)},m(t,s){a(t,e,s),i(e,n),i(n,o),i(n,r),i(e,c),$.m(e,null),i(e,l)},p(t,n){1&n&&s!==(s=t[1].name+"")&&b(o,s),f===(f=u(t))&&$?$.p(t,n):($.d(1),$=f(t),$&&($.c(),$.m(e,l))),1&n&&v(e,"solved",t[1].solved)},d(t){t&&d(e),$.d()}}}function Tt(e){let n,o=e[0],r=[];for(let t=0;t<o.length;t+=1)r[t]=Nt(Ot(e,o,t));return{c(){n=p("div");for(let t=0;t<r.length;t+=1)r[t].c();g(n,"class","opponent-progress-container svelte-127q1j8")},m(t,e){a(t,n,e);for(let t=0;t<r.length;t+=1)r[t].m(n,null)},p(t,[e]){if(1&e){let c;for(o=t[0],c=0;c<o.length;c+=1){const l=Ot(t,o,c);r[c]?r[c].p(l,e):(r[c]=Nt(l),r[c].c(),r[c].m(n,null))}for(;c<r.length;c+=1)r[c].d(1);r.length=o.length}},i:t,o:t,d(t){t&&d(n),f(r,t)}}}function Bt(t,e,n){let o;return u(t,X,(t=>n(0,o=t))),[o]}class It extends D{constructor(t){super(),Z(this,t,Bt,Tt,c,{})}}function Jt(e){let n,o={ctx:e,current:null,token:null,hasCatch:!1,pending:Rt,then:Kt,catch:Ft,value:8};var r;return function(t,e){const n=e.token={};function o(t,o,r,c){if(e.token!==n)return;e.resolved=c;let l=e.ctx;void 0!==r&&(l=l.slice(),l[r]=c);const s=t&&(e.current=t)(l);let u=!1;e.block&&(e.blocks?e.blocks.forEach(((t,n)=>{n!==o&&t&&(T(),J(t,1,1,(()=>{e.blocks[n]===t&&(e.blocks[n]=null)})),B())})):e.block.d(1),s.c(),I(s,1),s.m(e.mount(),e.anchor),u=!0),e.block=s,e.blocks&&(e.blocks[o]=s),u&&S()}if((r=t)&&"object"==typeof r&&"function"==typeof r.then){const n=w();if(t.then((t=>{x(n),o(e.then,1,e.value,t),x(null)}),(t=>{if(x(n),o(e.catch,2,e.error,t),x(null),!e.hasCatch)throw t})),e.current!==e.pending)return o(e.pending,0),!0}else{if(e.current!==e.then)return o(e.then,1,e.value,t),!0;e.resolved=t}var r}((r=dt,new Promise((t=>{const e=Y.subscribe((n=>{if(""===n)return;const o=pt.connect(r);e(),ht(o).then(t)}))}))),o),{c(){n=m(""),o.block.c()},m(t,e){a(t,n,e),o.block.m(t,o.anchor=e),o.mount=()=>n.parentNode,o.anchor=n},p(t,n){!function(t,e,n){const o=e.slice(),{resolved:r}=t;t.current===t.then&&(o[t.value]=r),t.current===t.catch&&(o[t.error]=r),t.block.p(o,n)}(o,e=t,n)},i:t,o:t,d(t){t&&d(n),o.block.d(t),o.token=null,o=null}}}function Ut(e){let n,o;return n=new yt({}),{c(){U(n.$$.fragment)},m(t,e){F(n,t,e),o=!0},p:t,i(t){o||(I(n.$$.fragment,t),o=!0)},o(t){J(n.$$.fragment,t),o=!1},d(t){K(n,t)}}}function Ft(e){return{c:t,m:t,p:t,d:t}}function Kt(e){let n;return{c(){n=p("p"),n.textContent=`Successfully connected to ${dt}`},m(t,e){a(t,n,e)},p:t,d(t){t&&d(n)}}}function Rt(e){let n;return{c(){n=p("p"),n.textContent=`Connecting to ${dt}`},m(t,e){a(t,n,e)},p:t,d(t){t&&d(n)}}}function Zt(t){let e,n,o,r;return e=new It({}),o=new Lt({props:{problem:t[0]}}),o.$on("progress",t[4]),o.$on("solved",t[5]),{c(){U(e.$$.fragment),n=h(),U(o.$$.fragment)},m(t,c){F(e,t,c),a(t,n,c),F(o,t,c),r=!0},p(t,e){const n={};1&e&&(n.problem=t[0]),o.$set(n)},i(t){r||(I(e.$$.fragment,t),I(o.$$.fragment,t),r=!0)},o(t){J(e.$$.fragment,t),J(o.$$.fragment,t),r=!1},d(t){K(e,t),t&&d(n),K(o,t)}}}function Dt(e){let n,o,r,c,l,s;const u=[Ut,Jt],f=[];o=ft?0:1,r=f[o]=u[o](e);let m=e[0]&&Zt(e),b=ft&&function(e){let n,o,r;return{c(){n=p("button"),n.textContent="New Problem",g(n,"class","svelte-1lo3kvs")},m(t,c){a(t,n,c),o||(r=$(n,"click",e[1]),o=!0)},p:t,d(t){t&&d(n),o=!1,r()}}}(e);return{c(){n=p("main"),r.c(),c=h(),m&&m.c(),l=h(),b&&b.c()},m(t,e){a(t,n,e),f[o].m(n,null),i(n,c),m&&m.m(n,null),i(n,l),b&&b.m(n,null),s=!0},p(t,[e]){r.p(t,e),t[0]?m?(m.p(t,e),1&e&&I(m,1)):(m=Zt(t),m.c(),I(m,1),m.m(n,l)):m&&(T(),J(m,1,1,(()=>{m=null})),B()),ft&&b.p(t,e)},i(t){s||(I(r),I(m),s=!0)},o(t){J(r),J(m),s=!1},d(t){t&&d(n),f[o].d(),m&&m.d(),b&&b.d()}}}function Gt(t,e,n){let o,r,c;u(t,X,(t=>n(2,o=t))),u(t,Y,(t=>n(3,r=t))),u(t,tt,(t=>n(0,c=t)));const l=(()=>{const t=fetch(`./quotes/${parseInt(8*Math.random())}.json`).then((t=>t.json()));return async()=>{const e=await t,n=e[parseInt(Math.random()*e.length)];return{author:n.quoteAuthor,text:Q(n.quoteText)}}})();return t.$$.update=()=>{t.$$.dirty,t.$$.dirty},[c,()=>{l().then((t=>tt.set((t=>{const e=t.text.toUpperCase(),n=H(),o=[...e].map((t=>n[G.indexOf(t)]??t)).join("");return{...t,plaintext:e,ciphertext:o}})(t))))},o,r,t=>ot.set(t.detail.progress),()=>rt.set(!0)]}const Ht=new class extends D{constructor(t){super(),Z(this,t,Gt,Dt,c,{})}}({target:document.body,props:{name:"world"}});return"undefined"!=typeof module&&module.hot&&("undefined"!=typeof module&&module.hot.dispose((()=>{Ht.$destroy()})),"undefined"!=typeof module&&module.hot.accept()),Ht}();
//# sourceMappingURL=bundle.js.map
