var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function s(t){let e;return l(t,(t=>e=t))(),e}function u(t,e,n){t.$$.on_destroy.push(l(e,n))}function i(t,e){t.appendChild(e)}function a(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode.removeChild(t)}function f(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function h(){return m(" ")}function g(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function $(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function b(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function v(t,e,n){t.classList[n?"add":"remove"](e)}let y;function x(t){y=t}function w(){if(!y)throw new Error("Function called outside component initialization");return y}function k(){const t=w();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const r=function(t,e,n=!1){const o=document.createEvent("CustomEvent");return o.initCustomEvent(t,n,!1,e),o}(e,n);o.slice().forEach((e=>{e.call(t,r)}))}}}const _=[],C=[],E=[],A=[],j=Promise.resolve();let O=!1;function P(t){E.push(t)}const q=new Set;let S=0;function M(){const t=y;do{for(;S<_.length;){const t=_[S];S++,x(t),N(t.$$)}for(x(null),_.length=0,S=0;C.length;)C.pop()();for(let t=0;t<E.length;t+=1){const e=E[t];q.has(e)||(q.add(e),e())}E.length=0}while(_.length);for(;A.length;)A.pop()();O=!1,q.clear(),x(t)}function N(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(P)}}const B=new Set;let I;function L(){I={r:0,c:[],p:I}}function T(){I.r||o(I.c),I=I.p}function U(t,e){t&&t.i&&(B.delete(t),t.i(e))}function z(t,e,n,o){if(t&&t.o){if(B.has(t))return;B.add(t),I.c.push((()=>{B.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function F(t){t&&t.c()}function K(t,n,c,l){const{fragment:s,on_mount:u,on_destroy:i,after_update:a}=t.$$;s&&s.m(n,c),l||P((()=>{const n=u.map(e).filter(r);i?i.push(...n):o(n),t.$$.on_mount=[]})),a.forEach(P)}function R(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Z(t,e){-1===t.$$.dirty[0]&&(_.push(t),O||(O=!0,j.then(M)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function D(e,r,c,l,s,u,i,a=[-1]){const f=y;x(e);const p=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(f?f.$$.context:[])),callbacks:n(),dirty:a,skip_bound:!1,root:r.target||f.$$.root};i&&i(p.root);let m=!1;if(p.ctx=c?c(e,r.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return p.ctx&&s(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),m&&Z(e,t)),n})):[],p.update(),m=!0,o(p.before_update),p.fragment=!!l&&l(p.ctx),r.target){if(r.hydrate){const t=function(t){return Array.from(t.childNodes)}(r.target);p.fragment&&p.fragment.l(t),t.forEach(d)}else p.fragment&&p.fragment.c();r.intro&&U(e.$$.fragment),K(e,r.target,r.anchor,r.customElement),M()}x(f)}class G{$destroy(){R(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const H="ABCDEFGHIJKLMNOPQRSTUVWXYZ",J=()=>{const t=[...Array(26).keys()].map((t=>[Math.random(),t])).sort(((t,e)=>t[0]-e[0])).map((t=>t[1]));return t.some(((t,e)=>t==e))?J():t.map((t=>H[t]))},Q=t=>t.replace(/[^\x00-\x7F]+/g,""),V=[];function W(e,n=t){let o;const r=new Set;function l(t){if(c(e,t)&&(e=t,o)){const t=!V.length;for(const t of r)t[1](),V.push(t,e);if(t){for(let t=0;t<V.length;t+=2)V[t][0](V[t+1]);V.length=0}}}return{set:l,update:function(t){l(t(e))},subscribe:function(c,s=t){const u=[c,s];return r.add(u),1===r.size&&(o=n(l)||t),c(e),()=>{r.delete(u),0===r.size&&(o(),o=null)}}}}const X=W([{id:"",name:"",progress:null,solved:!1,conn:{}}].slice(1)),Y=W(""),tt=W(null),et=W(`person-${parseInt(1e4*Math.random())}`),nt=W(null),ot=W(null),rt=W(!1),ct=new Map,lt=function(e,n,c){const s=!Array.isArray(e),u=s?[e]:e,i=n.length<2;return a=e=>{let c=!1;const a=[];let d=0,f=t;const p=()=>{if(d)return;f();const o=n(s?a[0]:a,e);i?e(o):f=r(o)?o:t},m=u.map(((t,e)=>l(t,(t=>{a[e]=t,d&=~(1<<e),c&&p()}),(()=>{d|=1<<e}))));return c=!0,p(),function(){o(m),f()}},{subscribe:W(c,a).subscribe};var a}([Y,et,ot,rt],(([t,e,n,o])=>({id:t,name:e,progress:n,solved:o}))),st=0,ut=1,it=3,at=new URLSearchParams(location.search).get("game"),dt=null==at,ft=new window.Peer,pt=[(t,e)=>{X.update((n=>[...n,{id:t,name:e.name,progress:null,solved:!1}]))},(t,e)=>{tt.set(e.problem)},(t,e)=>{dt&&X.update((n=>n.map((n=>n.id!==t?n:{...n,progress:e.progress,solved:e.solved}))))},(t,e)=>{if(dt)return;const n=s(Y);X.set(e.users.filter((t=>t.id!==n)))}],mt=t=>new Promise((e=>{t.on("open",(()=>{var n;t.peer==at&&nt.set(t),ct.set(t.peer,t),t.on("data",(n=t.peer,t=>{console.log("got data",t),pt[t.type]&&pt[t.type](n,t)})),t.on("close",(t=>()=>{X.update((e=>e.filter((e=>e.id!==t)))),ct.delete(t)})(t.peer)),setTimeout((()=>{(t=>{t?.send({type:st,name:s(et)})})(t)}),100),e(t)}))})),ht=t=>ct.forEach((e=>e.send(t)));ft.on("open",Y.set),ft.on("connection",mt);const gt=[lt.subscribe((t=>{console.log("own state changed",t),dt&&ht({type:it,users:[...s(X).map((t=>({...t,conn:null}))),t]})})),tt.subscribe((t=>{dt&&ht({type:ut,problem:t})}))];function $t(t,e,n){const o=t.slice();o[6]=e[n],o[8]=n;const r=o[2][o[8]];return o[1]=r,o}function bt(t){let e,n,o,r,c,l,s,u,f,y,x=t[6]+"",w=t[1]+"";return{c(){e=p("div"),n=p("div"),o=m(x),r=h(),c=p("div"),l=p("pre"),s=m(w),u=h(),$(n,"class","cipher-letter svelte-1x2ot2m"),$(c,"class","decrypted-letter svelte-1x2ot2m"),$(c,"tabindex","0"),v(c,"non-alphabetic",null===t[1]),$(e,"class","plain-encrypt-pair svelte-1x2ot2m")},m(d,p){a(d,e,p),i(e,n),i(n,o),i(e,r),i(e,c),i(c,l),i(l,s),i(e,u),f||(y=g(c,"keydown",t[3](t[8])),f=!0)},p(e,n){t=e,1&n&&x!==(x=t[6]+"")&&b(o,x),4&n&&w!==(w=t[1]+"")&&b(s,w),4&n&&v(c,"non-alphabetic",null===t[1])},d(t){t&&d(e),f=!1,y()}}}function vt(e){let n,o=e[0],r=[];for(let t=0;t<o.length;t+=1)r[t]=bt($t(e,o,t));return{c(){n=p("div");for(let t=0;t<r.length;t+=1)r[t].c();$(n,"class","word svelte-1x2ot2m")},m(t,e){a(t,n,e);for(let t=0;t<r.length;t+=1)r[t].m(n,null)},p(t,[e]){if(13&e){let c;for(o=t[0],c=0;c<o.length;c+=1){const l=$t(t,o,c);r[c]?r[c].p(l,e):(r[c]=bt(l),r[c].c(),r[c].m(n,null))}for(;c<r.length;c+=1)r[c].d(1);r.length=o.length}},i:t,o:t,d(t){t&&d(n),f(r,t)}}}function yt(t,e,n){let o,{word:r=""}=e,{replacement:c=Array(26).fill("")}=e;const l=k();return t.$$set=t=>{"word"in t&&n(0,r=t.word),"replacement"in t&&n(1,c=t.replacement)},t.$$.update=()=>{3&t.$$.dirty&&n(2,o=((t,e)=>[...t].map((t=>{const n=H.indexOf(t);return-1===n?null:e[n]})))(r,c))},[r,c,o,t=>e=>{l("replace",{from:r[t],to:e.key.toUpperCase()})}]}window.$cryptoduel$subscriptions&&window.$cryptoduel$subscriptions.forEach((t=>t())),window.$cryptoduel$subscriptions=gt;class xt extends G{constructor(t){super(),D(this,t,yt,vt,c,{word:0,replacement:1})}}function wt(t,e,n){const o=t.slice();return o[9]=e[n],o}function kt(t){let e,n;return e=new xt({props:{word:t[9],replacement:t[0]}}),e.$on("replace",t[5]),{c(){F(e.$$.fragment)},m(t,o){K(e,t,o),n=!0},p(t,n){const o={};4&n&&(o.word=t[9]),1&n&&(o.replacement=t[0]),e.$set(o)},i(t){n||(U(e.$$.fragment,t),n=!0)},o(t){z(e.$$.fragment,t),n=!1},d(t){R(e,t)}}}function _t(t){let e,n,o=t[2],r=[];for(let e=0;e<o.length;e+=1)r[e]=kt(wt(t,o,e));const c=t=>z(r[t],1,1,(()=>{r[t]=null}));return{c(){e=p("div");for(let t=0;t<r.length;t+=1)r[t].c();$(e,"class","cryptogram svelte-14i8lw1"),v(e,"solved",t[1])},m(t,o){a(t,e,o);for(let t=0;t<r.length;t+=1)r[t].m(e,null);n=!0},p(t,[n]){if(13&n){let l;for(o=t[2],l=0;l<o.length;l+=1){const c=wt(t,o,l);r[l]?(r[l].p(c,n),U(r[l],1)):(r[l]=kt(c),r[l].c(),U(r[l],1),r[l].m(e,null))}for(L(),l=o.length;l<r.length;l+=1)c(l);T()}2&n&&v(e,"solved",t[1])},i(t){if(!n){for(let t=0;t<o.length;t+=1)U(r[t]);n=!0}},o(t){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)z(r[t]);n=!1},d(t){t&&d(e),f(r,t)}}}function Ct(t,e,n){let o,r,{problem:c=null}=e;const l=k();let s=Array(26).fill("");const u=({from:t,to:e})=>{if((1!=e.length||!/[a-zA-Z]/.test(e))&&"BACKSPACE"!==e)return;const o=[...s];o[H.indexOf(t)]="BACKSPACE"==e?"":e,n(0,s=o)},i=(t,e)=>[...e].map((e=>H.includes(e)&&""!==t[H.indexOf(e)]));var a;a=()=>{n(0,s=Array(26).fill(""))},w().$$.on_mount.push(a);return t.$$set=t=>{"problem"in t&&n(4,c=t.problem)},t.$$.update=()=>{16&t.$$.dirty&&n(2,o=(t=>[...t.split(/\s+/g)])(c.ciphertext)),17&t.$$.dirty&&n(1,r=((t,e)=>!!e&&[...e.ciphertext].every(((n,o)=>!H.includes(n)||e.plaintext[o]===t[H.indexOf(n)])))(s,c)),2&t.$$.dirty&&r&&l("solved"),17&t.$$.dirty&&l("progress",{progress:i(s,c.ciphertext)}),17&t.$$.dirty&&console.log("problem:",c,"replacement",s)},[s,r,o,u,c,t=>u(t.detail)]}class Et extends G{constructor(t){super(),D(this,t,Ct,_t,c,{problem:4})}}function At(t,e,n){const o=t.slice();return o[1]=e[n],o}function jt(t,e,n){const o=t.slice();return o[4]=e[n],o}function Ot(t){let e,n=t[1].progress,o=[];for(let e=0;e<n.length;e+=1)o[e]=qt(jt(t,n,e));return{c(){e=p("div");for(let t=0;t<o.length;t+=1)o[t].c();$(e,"class","opponent-progress svelte-127q1j8")},m(t,n){a(t,e,n);for(let t=0;t<o.length;t+=1)o[t].m(e,null)},p(t,r){if(1&r){let c;for(n=t[1].progress,c=0;c<n.length;c+=1){const l=jt(t,n,c);o[c]?o[c].p(l,r):(o[c]=qt(l),o[c].c(),o[c].m(e,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=n.length}},d(t){t&&d(e),f(o,t)}}}function Pt(e){let n;return{c(){n=p("p"),n.textContent="has not started yet..."},m(t,e){a(t,n,e)},p:t,d(t){t&&d(n)}}}function qt(t){let e;return{c(){e=p("div"),$(e,"class","progress-item svelte-127q1j8"),v(e,"has-done",t[4])},m(t,n){a(t,e,n)},p(t,n){1&n&&v(e,"has-done",t[4])},d(t){t&&d(e)}}}function St(t){let e,n,o,r,c,l,s=t[1].name+"";function u(t,e){return null==t[1].progress?Pt:Ot}let f=u(t),g=f(t);return{c(){e=p("div"),n=p("p"),o=m(s),r=m(":"),c=h(),g.c(),l=h(),$(e,"class","user-container svelte-127q1j8"),v(e,"solved",t[1].solved)},m(t,s){a(t,e,s),i(e,n),i(n,o),i(n,r),i(e,c),g.m(e,null),i(e,l)},p(t,n){1&n&&s!==(s=t[1].name+"")&&b(o,s),f===(f=u(t))&&g?g.p(t,n):(g.d(1),g=f(t),g&&(g.c(),g.m(e,l))),1&n&&v(e,"solved",t[1].solved)},d(t){t&&d(e),g.d()}}}function Mt(e){let n,o=e[0],r=[];for(let t=0;t<o.length;t+=1)r[t]=St(At(e,o,t));return{c(){n=p("div");for(let t=0;t<r.length;t+=1)r[t].c();$(n,"class","opponent-progress-container svelte-127q1j8")},m(t,e){a(t,n,e);for(let t=0;t<r.length;t+=1)r[t].m(n,null)},p(t,[e]){if(1&e){let c;for(o=t[0],c=0;c<o.length;c+=1){const l=At(t,o,c);r[c]?r[c].p(l,e):(r[c]=St(l),r[c].c(),r[c].m(n,null))}for(;c<r.length;c+=1)r[c].d(1);r.length=o.length}},i:t,o:t,d(t){t&&d(n),f(r,t)}}}function Nt(t,e,n){let o;return u(t,X,(t=>n(0,o=t))),[o]}class Bt extends G{constructor(t){super(),D(this,t,Nt,Mt,c,{})}}function It(t){let e,n={ctx:t,current:null,token:null,hasCatch:!1,pending:zt,then:Ut,catch:Tt,value:8};var o;return function(t,e){const n=e.token={};function o(t,o,r,c){if(e.token!==n)return;e.resolved=c;let l=e.ctx;void 0!==r&&(l=l.slice(),l[r]=c);const s=t&&(e.current=t)(l);let u=!1;e.block&&(e.blocks?e.blocks.forEach(((t,n)=>{n!==o&&t&&(L(),z(t,1,1,(()=>{e.blocks[n]===t&&(e.blocks[n]=null)})),T())})):e.block.d(1),s.c(),U(s,1),s.m(e.mount(),e.anchor),u=!0),e.block=s,e.blocks&&(e.blocks[o]=s),u&&M()}if((r=t)&&"object"==typeof r&&"function"==typeof r.then){const n=w();if(t.then((t=>{x(n),o(e.then,1,e.value,t),x(null)}),(t=>{if(x(n),o(e.catch,2,e.error,t),x(null),!e.hasCatch)throw t})),e.current!==e.pending)return o(e.pending,0),!0}else{if(e.current!==e.then)return o(e.then,1,e.value,t),!0;e.resolved=t}var r}((o=at,new Promise((t=>{const e=Y.subscribe((n=>{if(""===n)return;const r=ft.connect(o);e(),mt(r).then(t)}))}))),n),{c(){e=m(""),n.block.c()},m(t,o){a(t,e,o),n.block.m(t,n.anchor=o),n.mount=()=>e.parentNode,n.anchor=e},p(e,o){!function(t,e,n){const o=e.slice(),{resolved:r}=t;t.current===t.then&&(o[t.value]=r),t.current===t.catch&&(o[t.error]=r),t.block.p(o,n)}(n,t=e,o)},d(t){t&&d(e),n.block.d(t),n.token=null,n=null}}}function Lt(t){let e,n,o;return{c(){e=p("p"),n=p("a"),o=m(t[0]),$(n,"href",t[0])},m(t,r){a(t,e,r),i(e,n),i(n,o)},p(t,e){1&e&&b(o,t[0]),1&e&&$(n,"href",t[0])},d(t){t&&d(e)}}}function Tt(e){return{c:t,m:t,p:t,d:t}}function Ut(e){let n;return{c(){n=p("p"),n.textContent=`Successfully connected to ${at}`},m(t,e){a(t,n,e)},p:t,d(t){t&&d(n)}}}function zt(e){let n;return{c(){n=p("p"),n.textContent=`Connecting to ${at}`},m(t,e){a(t,n,e)},p:t,d(t){t&&d(n)}}}function Ft(t){let e,n,o,r;return e=new Bt({}),o=new Et({props:{problem:t[1]}}),o.$on("progress",t[5]),o.$on("solved",t[6]),{c(){F(e.$$.fragment),n=h(),F(o.$$.fragment)},m(t,c){K(e,t,c),a(t,n,c),K(o,t,c),r=!0},p(t,e){const n={};2&e&&(n.problem=t[1]),o.$set(n)},i(t){r||(U(e.$$.fragment,t),U(o.$$.fragment,t),r=!0)},o(t){z(e.$$.fragment,t),z(o.$$.fragment,t),r=!1},d(t){R(e,t),t&&d(n),R(o,t)}}}function Kt(e){let n,o,r,c;let l=(dt?Lt:It)(e),s=e[1]&&Ft(e),u=dt&&function(e){let n,o,r;return{c(){n=p("button"),n.textContent="New Problem",$(n,"class","svelte-1lo3kvs")},m(t,c){a(t,n,c),o||(r=g(n,"click",e[2]),o=!0)},p:t,d(t){t&&d(n),o=!1,r()}}}(e);return{c(){n=p("main"),l.c(),o=h(),s&&s.c(),r=h(),u&&u.c()},m(t,e){a(t,n,e),l.m(n,null),i(n,o),s&&s.m(n,null),i(n,r),u&&u.m(n,null),c=!0},p(t,[e]){l.p(t,e),t[1]?s?(s.p(t,e),2&e&&U(s,1)):(s=Ft(t),s.c(),U(s,1),s.m(n,r)):s&&(L(),z(s,1,1,(()=>{s=null})),T()),dt&&u.p(t,e)},i(t){c||(U(s),c=!0)},o(t){z(s),c=!1},d(t){t&&d(n),l.d(),s&&s.d(),u&&u.d()}}}function Rt(t,e,n){let o,r,c,l;u(t,X,(t=>n(3,r=t))),u(t,Y,(t=>n(4,c=t))),u(t,tt,(t=>n(1,l=t)));const s=(()=>{const t=fetch(`./quotes/${parseInt(8*Math.random())}.json`).then((t=>t.json()));return async()=>{const e=await t,n=e[parseInt(Math.random()*e.length)];return{author:n.quoteAuthor,text:Q(n.quoteText)}}})();return t.$$.update=()=>{16&t.$$.dirty&&n(0,o=`${location.href}?game=${encodeURIComponent(c)}`),8&t.$$.dirty&&console.log("users:",r)},[o,l,()=>{s().then((t=>tt.set((t=>{const e=t.text.toUpperCase(),n=J(),o=[...e].map((t=>n[H.indexOf(t)]??t)).join("");return{...t,plaintext:e,ciphertext:o}})(t))))},r,c,t=>ot.set(t.detail.progress),()=>rt.set(!0)]}const Zt=new class extends G{constructor(t){super(),D(this,t,Rt,Kt,c,{})}}({target:document.body,props:{name:"world"}});return"undefined"!=typeof module&&module.hot&&("undefined"!=typeof module&&module.hot.dispose((()=>{Zt.$destroy()})),"undefined"!=typeof module&&module.hot.accept()),Zt}();
//# sourceMappingURL=bundle.js.map
