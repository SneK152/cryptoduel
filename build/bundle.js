var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function s(t){let e;return l(t,(t=>e=t))(),e}function u(t,e,n){t.$$.on_destroy.push(l(e,n))}function i(t,e){t.appendChild(e)}function a(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode.removeChild(t)}function f(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function h(){return m(" ")}function $(){return m("")}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function b(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function y(t,e,n){t.classList[n?"add":"remove"](e)}let v;function x(t){v=t}function k(){if(!v)throw new Error("Function called outside component initialization");return v}function w(){const t=k();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const r=function(t,e,n=!1){const o=document.createEvent("CustomEvent");return o.initCustomEvent(t,n,!1,e),o}(e,n);o.slice().forEach((e=>{e.call(t,r)}))}}}const _=[],C=[],E=[],A=[],O=Promise.resolve();let P=!1;function S(t){E.push(t)}const j=new Set;let M=0;function L(){const t=v;do{for(;M<_.length;){const t=_[M];M++,x(t),N(t.$$)}for(x(null),_.length=0,M=0;C.length;)C.pop()();for(let t=0;t<E.length;t+=1){const e=E[t];j.has(e)||(j.add(e),e())}E.length=0}while(_.length);for(;A.length;)A.pop()();P=!1,j.clear(),x(t)}function N(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(S)}}const B=new Set;let I;function T(){I={r:0,c:[],p:I}}function U(){I.r||o(I.c),I=I.p}function q(t,e){t&&t.i&&(B.delete(t),t.i(e))}function z(t,e,n,o){if(t&&t.o){if(B.has(t))return;B.add(t),I.c.push((()=>{B.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function F(t,e){const n=e.token={};function o(t,o,r,c){if(e.token!==n)return;e.resolved=c;let l=e.ctx;void 0!==r&&(l=l.slice(),l[r]=c);const s=t&&(e.current=t)(l);let u=!1;e.block&&(e.blocks?e.blocks.forEach(((t,n)=>{n!==o&&t&&(T(),z(t,1,1,(()=>{e.blocks[n]===t&&(e.blocks[n]=null)})),U())})):e.block.d(1),s.c(),q(s,1),s.m(e.mount(),e.anchor),u=!0),e.block=s,e.blocks&&(e.blocks[o]=s),u&&L()}if((r=t)&&"object"==typeof r&&"function"==typeof r.then){const n=k();if(t.then((t=>{x(n),o(e.then,1,e.value,t),x(null)}),(t=>{if(x(n),o(e.catch,2,e.error,t),x(null),!e.hasCatch)throw t})),e.current!==e.pending)return o(e.pending,0),!0}else{if(e.current!==e.then)return o(e.then,1,e.value,t),!0;e.resolved=t}var r}function K(t,e,n){const o=e.slice(),{resolved:r}=t;t.current===t.then&&(o[t.value]=r),t.current===t.catch&&(o[t.error]=r),t.block.p(o,n)}function R(t){t&&t.c()}function Q(t,n,c,l){const{fragment:s,on_mount:u,on_destroy:i,after_update:a}=t.$$;s&&s.m(n,c),l||S((()=>{const n=u.map(e).filter(r);i?i.push(...n):o(n),t.$$.on_mount=[]})),a.forEach(S)}function Z(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function D(t,e){-1===t.$$.dirty[0]&&(_.push(t),P||(P=!0,O.then(L)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function G(e,r,c,l,s,u,i,a=[-1]){const f=v;x(e);const p=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(f?f.$$.context:[])),callbacks:n(),dirty:a,skip_bound:!1,root:r.target||f.$$.root};i&&i(p.root);let m=!1;if(p.ctx=c?c(e,r.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return p.ctx&&s(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),m&&D(e,t)),n})):[],p.update(),m=!0,o(p.before_update),p.fragment=!!l&&l(p.ctx),r.target){if(r.hydrate){const t=function(t){return Array.from(t.childNodes)}(r.target);p.fragment&&p.fragment.l(t),t.forEach(d)}else p.fragment&&p.fragment.c();r.intro&&q(e.$$.fragment),Q(e,r.target,r.anchor,r.customElement),L()}x(f)}class H{$destroy(){Z(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const J="ABCDEFGHIJKLMNOPQRSTUVWXYZ",V=()=>{const t=[...Array(26).keys()].map((t=>[Math.random(),t])).sort(((t,e)=>t[0]-e[0])).map((t=>t[1]));return t.some(((t,e)=>t==e))?V():t.map((t=>J[t]))},W=t=>{const e=t.text.toUpperCase(),n=V(),o=[...e].map((t=>n[J.indexOf(t)]??t)).join("");return{...t,plaintext:e,ciphertext:o}},X=t=>t.replace(/[^\x00-\x7F]+/g,""),Y=[];function tt(e,n=t){let o;const r=new Set;function l(t){if(c(e,t)&&(e=t,o)){const t=!Y.length;for(const t of r)t[1](),Y.push(t,e);if(t){for(let t=0;t<Y.length;t+=2)Y[t][0](Y[t+1]);Y.length=0}}}return{set:l,update:function(t){l(t(e))},subscribe:function(c,s=t){const u=[c,s];return r.add(u),1===r.size&&(o=n(l)||t),c(e),()=>{r.delete(u),0===r.size&&(o(),o=null)}}}}const et=tt([{id:"",name:"",progress:null,solved:!1,conn:{}}].slice(1)),nt=tt(""),ot=tt(null),rt=tt(`name: person-${parseInt(1e4*Math.random())}`),ct=tt(null),lt=tt(null),st=tt(!1),ut=new Map,it=function(e,n,c){const s=!Array.isArray(e),u=s?[e]:e,i=n.length<2;return a=e=>{let c=!1;const a=[];let d=0,f=t;const p=()=>{if(d)return;f();const o=n(s?a[0]:a,e);i?e(o):f=r(o)?o:t},m=u.map(((t,e)=>l(t,(t=>{a[e]=t,d&=~(1<<e),c&&p()}),(()=>{d|=1<<e}))));return c=!0,p(),function(){o(m),f()}},{subscribe:tt(c,a).subscribe};var a}([nt,rt,lt,st],(([t,e,n,o])=>({id:t,name:e,progress:n,solved:o}))),at=0,dt=3,ft=new URLSearchParams(location.search).get("game"),pt=null==ft,mt=new window.Peer,ht=[(t,e)=>{et.update((n=>[...n,{id:t,name:e.name,progress:null,solved:!1}]))},(t,e)=>{ot.set(e.problem)},(t,e)=>{pt&&et.update((n=>n.map((n=>n.id!==t?n:{...n,progress:e.progress,solved:e.solved}))))},(t,e)=>{if(pt)return;const n=s(nt);et.set(e.users.filter((t=>t.id!==n)))}],$t=t=>new Promise((e=>{t.on("open",(()=>{var n;t.peer==ft&&ct.set(t),ut.set(t.peer,t),t.on("data",(n=t.peer,t=>{console.log("got data",t),ht[t.type]&&ht[t.type](n,t)})),t.on("close",(t=>()=>{et.update((e=>e.filter((e=>e.id!==t)))),ut.delete(t)})(t.peer)),setTimeout((()=>{(t=>{t?.send({type:at,name:s(rt)})})(t)}),100),e(t)}))}));mt.on("open",nt.set),mt.on("connection",$t);const gt=[it.subscribe((t=>{var e;console.log("own state changed",t),pt&&(e={type:dt,users:[...s(et).map((t=>({...t,conn:null}))),t]},ut.forEach((t=>t.send(e))))}))];function bt(t,e,n){const o=t.slice();o[6]=e[n],o[8]=n;const r=o[2][o[8]];return o[1]=r,o}function yt(t){let e,n,o,r,c,l,s,u,f,$,v=t[6]+"",x=t[1]+"";return{c(){e=p("div"),n=p("div"),o=m(v),r=h(),c=p("div"),l=p("pre"),s=m(x),u=h(),g(n,"class","cipher-letter svelte-1x2ot2m"),g(c,"class","decrypted-letter svelte-1x2ot2m"),g(c,"tabindex","0"),y(c,"non-alphabetic",null===t[1]),g(e,"class","plain-encrypt-pair svelte-1x2ot2m")},m(d,p){var m,h,g,b;a(d,e,p),i(e,n),i(n,o),i(e,r),i(e,c),i(c,l),i(l,s),i(e,u),f||(m=c,h="keydown",g=t[3](t[8]),m.addEventListener(h,g,b),$=()=>m.removeEventListener(h,g,b),f=!0)},p(e,n){t=e,1&n&&v!==(v=t[6]+"")&&b(o,v),4&n&&x!==(x=t[1]+"")&&b(s,x),4&n&&y(c,"non-alphabetic",null===t[1])},d(t){t&&d(e),f=!1,$()}}}function vt(e){let n,o=e[0],r=[];for(let t=0;t<o.length;t+=1)r[t]=yt(bt(e,o,t));return{c(){n=p("div");for(let t=0;t<r.length;t+=1)r[t].c();g(n,"class","word svelte-1x2ot2m")},m(t,e){a(t,n,e);for(let t=0;t<r.length;t+=1)r[t].m(n,null)},p(t,[e]){if(13&e){let c;for(o=t[0],c=0;c<o.length;c+=1){const l=bt(t,o,c);r[c]?r[c].p(l,e):(r[c]=yt(l),r[c].c(),r[c].m(n,null))}for(;c<r.length;c+=1)r[c].d(1);r.length=o.length}},i:t,o:t,d(t){t&&d(n),f(r,t)}}}function xt(t,e,n){let o,{word:r=""}=e,{replacement:c=Array(26).fill("")}=e;const l=w();return t.$$set=t=>{"word"in t&&n(0,r=t.word),"replacement"in t&&n(1,c=t.replacement)},t.$$.update=()=>{3&t.$$.dirty&&n(2,o=((t,e)=>[...t].map((t=>{const n=J.indexOf(t);return-1===n?null:e[n]})))(r,c))},[r,c,o,t=>e=>{l("replace",{from:r[t],to:e.key.toUpperCase()})}]}window.$cryptoduel$subscriptions&&window.$cryptoduel$subscriptions.forEach((t=>t())),window.$cryptoduel$subscriptions=gt;class kt extends H{constructor(t){super(),G(this,t,xt,vt,c,{word:0,replacement:1})}}function wt(t,e,n){const o=t.slice();return o[9]=e[n],o}function _t(t){let e,n;return e=new kt({props:{word:t[9],replacement:t[0]}}),e.$on("replace",t[5]),{c(){R(e.$$.fragment)},m(t,o){Q(e,t,o),n=!0},p(t,n){const o={};4&n&&(o.word=t[9]),1&n&&(o.replacement=t[0]),e.$set(o)},i(t){n||(q(e.$$.fragment,t),n=!0)},o(t){z(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function Ct(t){let e,n,o=t[2],r=[];for(let e=0;e<o.length;e+=1)r[e]=_t(wt(t,o,e));const c=t=>z(r[t],1,1,(()=>{r[t]=null}));return{c(){e=p("div");for(let t=0;t<r.length;t+=1)r[t].c();g(e,"class","cryptogram svelte-14i8lw1"),y(e,"solved",t[1])},m(t,o){a(t,e,o);for(let t=0;t<r.length;t+=1)r[t].m(e,null);n=!0},p(t,[n]){if(13&n){let l;for(o=t[2],l=0;l<o.length;l+=1){const c=wt(t,o,l);r[l]?(r[l].p(c,n),q(r[l],1)):(r[l]=_t(c),r[l].c(),q(r[l],1),r[l].m(e,null))}for(T(),l=o.length;l<r.length;l+=1)c(l);U()}2&n&&y(e,"solved",t[1])},i(t){if(!n){for(let t=0;t<o.length;t+=1)q(r[t]);n=!0}},o(t){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)z(r[t]);n=!1},d(t){t&&d(e),f(r,t)}}}function Et(t,e,n){let o,r,{problem:c=null}=e;const l=w();let s=Array(26).fill("");const u=({from:t,to:e})=>{if((1!=e.length||!/[a-zA-Z]/.test(e))&&"BACKSPACE"!==e)return;const o=[...s];o[J.indexOf(t)]="BACKSPACE"==e?"":e,n(0,s=o)},i=(t,e)=>[...e].map((e=>J.includes(e)&&""!==t[J.indexOf(e)]));var a;a=()=>{n(0,s=Array(26).fill(""))},k().$$.on_mount.push(a);return t.$$set=t=>{"problem"in t&&n(4,c=t.problem)},t.$$.update=()=>{16&t.$$.dirty&&n(2,o=(t=>[...t.split(/\s+/g)])(c.ciphertext)),17&t.$$.dirty&&n(1,r=((t,e)=>!!e&&[...e.ciphertext].every(((n,o)=>!J.includes(n)||e.plaintext[o]===t[J.indexOf(n)])))(s,c)),2&t.$$.dirty&&r&&l("solved"),17&t.$$.dirty&&l("progress",{progress:i(s,c.ciphertext)}),17&t.$$.dirty&&console.log("problem:",c,"replacement",s)},[s,r,o,u,c,t=>u(t.detail)]}class At extends H{constructor(t){super(),G(this,t,Et,Ct,c,{problem:4})}}function Ot(e){let n,o={ctx:e,current:null,token:null,hasCatch:!1,pending:Mt,then:jt,catch:St,value:7};var r;return F((r=ft,new Promise((t=>{const e=nt.subscribe((n=>{if(""===n)return;const o=mt.connect(r);e(),$t(o).then(t)}))}))),o),{c(){n=$(),o.block.c()},m(t,e){a(t,n,e),o.block.m(t,o.anchor=e),o.mount=()=>n.parentNode,o.anchor=n},p(t,n){K(o,e=t,n)},i:t,o:t,d(t){t&&d(n),o.block.d(t),o.token=null,o=null}}}function Pt(t){let e,n,o,r,c,l={ctx:t,current:null,token:null,hasCatch:!1,pending:Bt,then:Nt,catch:Lt,value:1,blocks:[,,,]};return F(t[1],l),{c(){e=p("a"),n=m(t[0]),o=h(),r=$(),l.block.c(),g(e,"href",t[0]),g(e,"class","svelte-ux6855")},m(t,s){a(t,e,s),i(e,n),a(t,o,s),a(t,r,s),l.block.m(t,l.anchor=s),l.mount=()=>r.parentNode,l.anchor=r,c=!0},p(o,r){t=o,(!c||1&r)&&b(n,t[0]),(!c||1&r)&&g(e,"href",t[0]),K(l,t,r)},i(t){c||(q(l.block),c=!0)},o(t){for(let t=0;t<3;t+=1){z(l.blocks[t])}c=!1},d(t){t&&d(e),t&&d(o),t&&d(r),l.block.d(t),l.token=null,l=null}}}function St(e){return{c:t,m:t,p:t,d:t}}function jt(e){let n;return{c(){n=p("p"),n.textContent=`Successfully connected to ${ft}`},m(t,e){a(t,n,e)},p:t,d(t){t&&d(n)}}}function Mt(e){let n;return{c(){n=p("p"),n.textContent=`Connecting to ${ft}`},m(t,e){a(t,n,e)},p:t,d(t){t&&d(n)}}}function Lt(e){return{c:t,m:t,p:t,i:t,o:t,d:t}}function Nt(e){let n,o;return n=new At({props:{problem:W(e[1])}}),n.$on("progress",e[4]),n.$on("solved",e[5]),{c(){R(n.$$.fragment)},m(t,e){Q(n,t,e),o=!0},p:t,i(t){o||(q(n.$$.fragment,t),o=!0)},o(t){z(n.$$.fragment,t),o=!1},d(t){Z(n,t)}}}function Bt(e){let n;return{c(){n=p("p"),n.textContent="Loading Quote"},m(t,e){a(t,n,e)},p:t,i:t,o:t,d(t){t&&d(n)}}}function It(t){let e,n,o,r;const c=[Pt,Ot],l=[];return n=pt?0:1,o=l[n]=c[n](t),{c(){e=p("main"),o.c()},m(t,o){a(t,e,o),l[n].m(e,null),r=!0},p(t,[e]){o.p(t,e)},i(t){r||(q(o),r=!0)},o(t){z(o),r=!1},d(t){t&&d(e),l[n].d()}}}function Tt(t,e,n){let o,r,c;u(t,et,(t=>n(2,r=t))),u(t,nt,(t=>n(3,c=t)));const l=(()=>{const t=fetch(`./quotes/${parseInt(8*Math.random())}.json`).then((t=>t.json()));return async()=>{const e=await t,n=e[parseInt(Math.random()*e.length)];return{author:n.quoteAuthor,text:X(n.quoteText)}}})(),s=l();return t.$$.update=()=>{8&t.$$.dirty&&n(0,o=`${location.href}?game=${encodeURIComponent(c)}`),4&t.$$.dirty&&console.log("users:",r)},[o,s,r,c,t=>lt.set(t.detail.progress),()=>st.set(!0)]}const Ut=new class extends H{constructor(t){super(),G(this,t,Tt,It,c,{})}}({target:document.body,props:{name:"world"}});return"undefined"!=typeof module&&module.hot&&("undefined"!=typeof module&&module.hot.dispose((()=>{Ut.$destroy()})),"undefined"!=typeof module&&module.hot.accept()),Ut}();
//# sourceMappingURL=bundle.js.map
